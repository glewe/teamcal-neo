{% extends 'layout.twig' %}

{% block content %}
  <style>
    /* Make the body take full viewport height */
    /* Make the body take full viewport height */
    html, body {
      height: 100%;
      padding-top: 0 !important;
    }
    /*
      Configure #main (defined in menu.twig) to be a flex column.
      This ensures the navbar stays at top, footer at bottom,
      and content can expand to fill the middle.
    */
    #main {
      display: flex !important;
      flex-direction: column !important;
      min-height: 100vh !important;
    }
    /*
      Wrapper to center the container within the available flex space
    */
    .login-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      width: 100%;
    }
  </style>

  <div class="login-wrapper">
    <div class="container content">
      <div class="row">

        <div class="col-lg-3"></div>

        <div class="col-lg-6">
          {{ alertHtml|raw }}

          <div class="card">
            <div class="card-header text-bg-{{ CONF.controllers[controller].panelColor }}">
              <div class="d-flex justify-content-center align-items-center gap-2 mb-3">
                <i class="bi-calendar-week logo-gradient me-2" style="font-size: 3rem;"></i>
                <span class="h3 fw-bold m-0">{{ constant('APP_NAME') }}</span>
              </div>
              <i class="{{ CONF.controllers[controller].faIcon }} fa-lg me-3"></i>
              {{ LANG.login_login }}
            </div>
            <div class="card-body">
              <div class="col-lg-12">
                <form id="login" action="index.php?action={{ controller }}" method="post" target="_self" name="loginform" accept-charset="utf-8">
                  <input name="csrf_token" type="hidden" value="{{ csrf_token }}">

                  <fieldset>
                    <div class="form-group row mb-3" style="padding-bottom: 12px;">
                      <label for="inputUsername" class="col-lg-5 control-label">{{ LANG.login_username }}</label>
                      <div class="col-lg-7">
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-user"></i></span>
                          {% set tabindex = tabindex + 1 %}
                          <input id="inputUsername" class="form-control" tabindex="{{ tabindex }}" autofocus="autofocus" name="uname" type="text" value="{{ uname }}">
                        </div>
                      </div>
                    </div>
                    <div class="form-group row" style="padding-bottom: 12px;">
                      <label for="pword" class="col-lg-5 control-label">{{ LANG.login_password }}</label>
                      <div class="col-lg-7">
                        <div class="input-group">
                          <span class="input-group-text"><i class="fas fa-lock"></i></span>
                          {% set tabindex = tabindex + 1 %}
                          <input class="form-control" id="pword" tabindex="{{ tabindex }}" name="pword" type="password" autocomplete="off">
                          <span class="input-group-text" style="cursor: pointer;" id="togglePassword">
                            <i class="fas fa-eye"></i>
                          </span>
                        </div>
                      </div>
                    </div>
                    <hr>

                    <!-- 2FA code input removed for new 2-step flow -->

                    <div class="form-group row">
                      <label for="inputSubmit" class="col-lg-5 control-label"></label>
                      <div class="col-lg-7">
                        {% set tabindex = tabindex + 1 %}
                        <input id="inputSubmit" name="btn_login" tabindex="{{ tabindex }}" type="text" value="true" style="visibility: hidden; display: none">
                        {% set tabindex = tabindex + 1 %}
                        <button type="submit" class="btn btn-primary" tabindex="{{ tabindex }}" name="submit">{{ LANG.btn_login }}</button>
                        {% set tabindex = tabindex + 1 %}
                        <a href="index.php?action=passwordrequest" class="btn btn-secondary float-end" tabindex="{{ tabindex }}">{{ LANG.btn_reset_password }}</a>
                      </div>
                    </div>
                  </fieldset>
                </form>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-3"></div>

      </div>
    </div>
  </div>
{% endblock %}

{% block javascripts %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const togglePassword = document.querySelector('#togglePassword');
      const password = document.querySelector('#pword');

      if (togglePassword && password) {
        togglePassword.addEventListener('click', function (e) {
          // toggle the type attribute
          const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
          password.setAttribute('type', type);
          // toggle the eye slash icon
          this.querySelector('i').classList.toggle('fa-eye-slash');
          this.querySelector('i').classList.toggle('fa-eye');
        });
      }
    });
  </script>
{% endblock %}
